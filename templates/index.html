<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì—¬ê°€ íë ˆì´ì…˜ (v28)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* v23ì—ì„œ ìš”ì²­í•œ 'ë¸”ë£¨/ê·¸ë¦°' í…Œë§ˆ CSS */
        body { 
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #F0FDF4, #F0F9FF);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 0.5rem;
        }
        /* í°ìƒ‰ ì¹´ë“œ UI (ëª¨ë°”ì¼/ì›¹ í˜¸í™˜) */
        #app-container { 
            max-width: 900px; 
            margin: 1rem auto; 
            max-height: 95vh;
            overflow-y: auto;
            border-radius: 1.5rem; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background: white;
            overflow: hidden; /* ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸ê°€ ë‘¥ê·¼ ëª¨ì„œë¦¬ë¥¼ ë”°ë¥´ë„ë¡ */
        }
        /* [ìš”ì²­ 1] ë¼ë²¨(ì œëª©)ì„ êµµê³  ì§„í•œ ì²­ë¡ìƒ‰ìœ¼ë¡œ */
        label[data-testid="block-label"] { 
            display: block; /* Gradio ëª¨ë°© */
            font-weight: 600; 
            color: #0F766E; /* ì§™ì€ ì²­ë¡ìƒ‰ */
            font-size: 1.05rem; /* ì‚´ì§ í¬ê²Œ */
            padding-bottom: 4px;
        }
        /* ê·¸ë£¹(í™”ë©´) ìŠ¤íƒ€ì¼ */
        .page-group { 
            background-color: white; 
            padding: 2rem;
        }
        /* í™”ë©´ ì œëª© ìŠ¤íƒ€ì¼ */
        .page-title { 
            font-size: 1.75rem; 
            font-weight: 700; 
            color: #0D9488; /* ì§™ì€ ì²­ë¡ìƒ‰ */
            border-bottom: 2px solid #CCFBF1; /* ì—°í•œ ì²­ë¡ìƒ‰ */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        /* [ìš”ì²­ 1] ì…ë ¥ì°½ í¬ì»¤ìŠ¤(í´ë¦­) ì‹œ */
        input[type="text"], input[type="number"], input[type="tel"], select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            background-color: #F9FAFB;
        }
        input[type="text"]:focus, 
        input[type="number"]:focus, 
        input[type="tel"]:focus,
        select:focus { 
            border-color: #0D9488 !important; 
            box-shadow: 0 0 0 3px #A7F3D0 !important; /* ë°ì€ ë…¹ìƒ‰ */
            transition: all 0.2s; 
            outline: none;
        }
        input[type="range"] { width: 100%; }
        /* ê²°ê³¼ì°½ ë””ìì¸ */
        #result-card { background-color: #F0FDF4; border-left: 5px solid #10B981; border-radius: 8px; padding: 1.5rem; }
        #result-title { color: #065F46; border-bottom: 2px solid #6EE7B7; }
        
        /* [ìš”ì²­ 3] 'ê¸°ë°˜ ë§Œì¡±ë„' ë¶€ì—°ì„¤ëª… í…ìŠ¤íŠ¸ */
        .description-text { 
            color: #4B5563; 
            font-style: italic; 
            margin-top: -0.75rem; 
            margin-bottom: 1rem; 
            font-size: 0.9rem;
        }
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .g-button { /* Gradio ë²„íŠ¼ ëª¨ë°© */
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            width: 100%; /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        }
        @media (min-width: 640px) { /* PCì—ì„œëŠ” ë²„íŠ¼ ë„ˆë¹„ ìë™ */
             .g-button { width: 100%; } /* v25ì—ì„œëŠ” í•­ìƒ 100% */
        }
        button.primary { background: #0D9488; color: white; } /* ì²­ë¡ìƒ‰ */
        button.primary:hover { background: #0F766E; }
        button.secondary { 
            background: #F0F9FF; color: #0284C7; 
            border: 1px solid #0284C7;
        }
        button.secondary:hover { background: #E0F2FE; }
        
        /* ê°œì¸ì •ë³´ë³´í˜¸ ë¬¸êµ¬ (ìš”ì²­ 4) */
        #privacy-text { font-size: 12px; color: #6B7280; text-align: center; margin-top: 1.5rem; }
    </style>
</head>
<body>
    
    <div id="app-container">
        
        <header class="p-6 bg-gradient-to-r from-blue-500 to-indigo-600 text-white text-center">
            <h1 class="text-3xl font-bold">AI ì—¬ê°€ ì»¨ì„¤í„´íŠ¸ (v28)</h1>
            <p class="mt-2 text-blue-100">AI ê¶¤ì  ì‹œë®¬ë ˆì´í„°</p>
        </header>

        <div id="loading" class="text-center p-8 hidden">
            <svg class="animate-spin h-10 w-10 text-indigo-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-gray-600">AIê°€ 504ê°œì˜ ê¶¤ì ì„ ì‹œë®¬ë ˆì´ì…˜ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <div id="page-simulator" class="page-group fade-in">
            <h2 class="page-title">AI ì—¬ê°€ ê¶¤ì  ì‹œë®¬ë ˆì´í„°</h2>
            <p class="text-gray-600 mb-6">AIê°€ 'ìµœì  ê¶¤ì 'ì„ íƒìƒ‰í•˜ëŠ” ê¸°ì¤€ì´ ë˜ëŠ” **ê³ ì • ë³€ìˆ˜**ì™€ **í˜„ì¬ ì—¬ê°€**ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</p>
            
            <div class="space-y-6">
                
                <h3 class="text-lg font-semibold text-gray-800 border-b pb-2">1. ê³ ì • ì •ë³´ (ë‚˜, ì§ì—…)</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label data-testid="block-label" for="i_age"><span>1. ë‚˜ì´ (<span id="age-display">39 ì„¸</span>)</span></label>
                        <input type="range" id="i_age" min="20" max="69" value="39">
                    </div>
                    <div>
                        <label data-testid="block-label" for="i_gender"><span>3. ì„±ë³„</span></label>
                        <select id="i_gender">
                            <option value="1" selected>ë‚¨ì„±</option>
                            <option value="2">ì—¬ì„±</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label data-testid="block-label" for="i_job"><span>2. ì§ì—…</span></label>
                        <select id="i_job">
                            <option value="1">ìì˜ì—…</option><option value="2">íŒë§¤/ì„œë¹„ìŠ¤ì§</option><option value="3">ê¸°ëŠ¥/ìˆ™ë ¨ê³µ</option>
                            <option value="4">ì¼ë°˜ì‘ì—…ì§</option><option value="5" selected>ì‚¬ë¬´ì§</option><option value="6">ê¸°ìˆ ì§</option>
                            <option value="7">ê²½ì˜/ê´€ë¦¬ì§</option><option value="8">ì „ë¬¸ì§</option><option value="9">ììœ ì§</option>
                            <option value="10">ì „ì—…ì£¼ë¶€</option><option value="11">ëŒ€í•™(ì›)ìƒ</option><option value="12">ë¬´ì§</option>
                            <option value="nan">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label data-testid="block-label" for="i_marriage"><span>4. ê²°í˜¼ìƒíƒœ</span></label>
                        <select id="i_marriage">
                            <option value="1">ë¯¸í˜¼</option>
                            <option value="2" selected>ê¸°í˜¼</option>
                            <option value="3">ê¸°íƒ€(ì´í˜¼/ì‚¬ë³„)</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label data-testid="block-label" for="i_income"><span>5. ê°€êµ¬ ì›”ì†Œë“ (<span id="income-display">400 ë§Œì›</span>)</span></label>
                    <input type="range" id="i_income" min="0" max="2000" step="50" value="400">
                </div>
                
                <h3 class="text-lg font-semibold text-gray-800 border-b pb-2 mt-6">2. ê¸°ë°˜ ë§Œì¡±ë„ (í˜„ì¬ ìƒíƒœ)</h3>
                <p class="description-text">í˜„ì¬ ì¦ê¸°ê³  ìˆëŠ” ì—¬ê°€ì— ê´€í•´ ë‹µí•´ì£¼ì„¸ìš”.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label data-testid="block-label" for="i_infra_sat"><span>6. ì¸í”„ë¼ ë§Œì¡±ë„ (<span id="infra-display">4 ì </span>)</span></label>
                        <input type="range" id="i_infra_sat" min="1" max="5" step="1" value="4">
                    </div>
                    <div>
                        <label data-testid="block-label" for="i_time_sat"><span>7. ì‹œê°„ ë§Œì¡±ë„ (<span id="time-display">4 ì </span>)</span></label>
                        <input type="range" id="i_time_sat" min="1" max="5" step="1" value="4">
                    </div>
                </div>

                <h3 class="text-lg font-semibold text-gray-800 border-b pb-2 mt-6">3. í˜„ì¬ ì—¬ê°€ í™œë™</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label data-testid="block-label" for="i_purpose"><span>8. í˜„ì¬ ì—¬ê°€ ëª©ì </span></label>
                        <select id="i_purpose">
                            <option value="1">ê°€ì¡±/ì§€ì¸</option><option value="2">ê±´ê°•</option><option value="3">ë‚¨ëŠ” ì‹œê°„</option>
                            <option value="4">ëŒ€ì¸ê´€ê³„</option><option value="5">íœ´ì‹</option><option value="6" selected>ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ</option>
                            <option value="7">ìê¸°ê³„ë°œ</option><option value="8">ìê¸°ë§Œì¡±/ì¦ê±°ì›€</option><option value="9">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label data-testid="block-label" for="i_activity"><span>9. í˜„ì¬ ì£¼ìš” í™œë™</span></label>
                        <select id="i_activity">
                            <option value="1">ë¬¸í™”ì˜ˆìˆ ê´€ëŒ</option><option value="2">ë¬¸í™”ì˜ˆìˆ ì§ì ‘</option><option value="3">ìŠ¤í¬ì¸ ê´€ëŒ</option>
                            <option value="4">ìŠ¤í¬ì¸ ì§ì ‘</option><option value="5">ê´€ê´‘/ì—¬í–‰</option><option value="6" selected>ì˜¤ë½/íœ´ì‹</option>
                            <option value="7">ìê¸°ê³„ë°œ</option><option value="8">ì‚¬íšŒêµë¥˜</option><option value="nan">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div>
                        <label data-testid="block-label" for="i_partner"><span>10. í˜„ì¬ ë™ë°˜ì</span></label>
                        <select id="i_partner">
                            <option value="1" selected>í˜¼ì</option><option value="2">ê°€ì¡±/ì¹œì²™</option><option value="3">ì¹œêµ¬</option>
                            <option value="4">ì—°ì¸</option><option value="5">ì§ì¥ë™ë£Œ</option><option value="6">ë™í˜¸íšŒ</option>
                            <option value="7">ê¸°íƒ€</option>
                        </select>
                    </div>
                </div>
                
                <button id="submit-btn" class="g-button primary w-full mt-8">ìµœì ì˜ ê¶¤ì  íƒìƒ‰í•˜ê¸° (AI ì‹œë®¬ë ˆì´ì…˜)</button>
                <p id="privacy-text">ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” AI íë ˆì´ì…˜ ë¶„ì„ ë° ëª¨ë¸ ì„±ì¥ì„ ìœ„í•´ì„œë§Œ ì €ì¥ë˜ë©°, ì™¸ë¶€ì— ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            </div>
        </div>

        <div id="page-results" class="page-group hidden fade-in">
            <h2 class="page-title" id="result-title">4. AI ì¶”ì²œ ê¶¤ì </h2>
            <p id="o_model_version" class="text-sm text-gray-400 -mt-8 mb-6">(AI Model: v1)</p>
            
            <div id="result-card" class="mb-6">
                <label data-testid="block-label" for="o_probability"><span>í˜„ì¬ ì¡°í•©ì˜ 5ì  ë§Œì¡±ë„ í™•ë¥ </span></label>
                <p id="o_probability" class="text-4xl font-bold text-green-700">0.0%</p>
                <label data-testid="block-label" for="o_persona" class="mt-4"><span>AI í˜ë¥´ì†Œë‚˜ ì§„ë‹¨ (í˜„ì¬ ê¸°ì¤€)</span></label>
                <p id="o_persona" class="text-lg font-semibold text-gray-700"></p>
            </div>
            
            <div>
                <label data-testid="block-label"><span>ğŸ“ˆ 'ë§Œì¡±ë„ 5ì 'ì„ ìœ„í•œ ìµœì ì˜ ê¶¤ì  (AI ì‹œë®¬ë ˆì´ì…˜)</span></label>
                <div id="o_recommendations" class="text-gray-700 space-y-4"></div>
            </div>
            
            <button id="restart-btn-4" class="g-button secondary w-full mt-8">ë‹¤ì‹œ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸°</button>
        </div>
        
    </div>

    <script>
        // --- 1. AI ì„œë²„(Render) ì£¼ì†Œ ---
        // [v28] 'ì¼ì²´í˜•' ì„œë²„ì´ë¯€ë¡œ '/predict'ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
        const AI_SERVER_URL = "/predict"; 

        // --- 2. UI ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const loadingEl = document.getElementById('loading');
        const pageSimulator = document.getElementById('page-simulator');
        const pageResults = document.getElementById('page-results');
        
        // ë²„íŠ¼
        const submitBtn = document.getElementById('submit-btn');
        const restartBtn4 = document.getElementById('restart-btn-4');
        
        // ê³ ì • ì •ë³´ ì…ë ¥
        const iAge = document.getElementById('i_age');
        const iGender = document.getElementById('i_gender');
        const iJob = document.getElementById('i_job');
        const iMarriage = document.getElementById('i_marriage');
        const iIncome = document.getElementById('i_income');
        const iInfraSat = document.getElementById('i_infra_sat');
        const iTimeSat = document.getElementById('i_time_sat');
        
        // ì‹œë®¬ë ˆì´í„° ì…ë ¥
        const iPurpose = document.getElementById('i_purpose');
        const iActivity = document.getElementById('i_activity');
        const iPartner = document.getElementById('i_partner');
        
        // ê²°ê³¼ ì¶œë ¥
        const oModelVersion = document.getElementById('o_model_version');
        const oProbability = document.getElementById('o_probability');
        const oPersona = document.getElementById('o_persona');
        const oRecommendations = document.getElementById('o_recommendations');

        // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ
        const updateSliderDisplay = (slider, display) => {
            const suffix = slider.id.includes('income') ? ' ë§Œì›' : (slider.id.includes('age') ? ' ì„¸' : ' ì ');
            display.textContent = slider.value + suffix;
        };
        const ageDisplay = document.getElementById('age-display');
        const incomeDisplay = document.getElementById('income-display');
        const infraDisplay = document.getElementById('infra-display');
        const timeDisplay = document.getElementById('time-display');
        
        iAge.addEventListener('input', () => updateSliderDisplay(iAge, ageDisplay));
        iIncome.addEventListener('input', () => updateSliderDisplay(iIncome, incomeDisplay));
        iInfraSat.addEventListener('input', () => updateSliderDisplay(iInfraSat, infraDisplay));
        iTimeSat.addEventListener('input', () => updateSliderDisplay(iTimeSat, timeDisplay));
        // ì´ˆê¸°ê°’ ì„¤ì •
        updateSliderDisplay(iAge, ageDisplay);
        updateSliderDisplay(iIncome, incomeDisplay);
        updateSliderDisplay(iInfraSat, infraDisplay);
        updateSliderDisplay(iTimeSat, timeDisplay);

        // --- 3. í•µì‹¬ ë¡œì§: í™”ë©´ ì „í™˜ í•¨ìˆ˜ ---
        function showPage(pageToShow) {
            [pageSimulator, pageResults, loadingEl].forEach(page => {
                page.style.display = 'none'; // hidden í´ë˜ìŠ¤ ëŒ€ì‹  display none ì‚¬ìš©
            });
            pageToShow.style.display = 'block';
        }

        // --- 4. í•µì‹¬ ë¡œì§: AI ì˜ˆì¸¡ (ê¶¤ì  ì‹œë®¬ë ˆì´í„°) ---
        submitBtn.addEventListener('click', async () => {
            
            // 1. 11ê°œ ì…ë ¥ê°’ ìˆ˜ì§‘
            const inputs = {
                'age': parseInt(iAge.value),
                'job': iJob.value,
                'gender': iGender.value,
                'marriage': iMarriage.value,
                'income': parseInt(iIncome.value),
                'infra_sat': parseInt(iInfraSat.value),
                'time_sat': parseInt(iTimeSat.value),
                'purpose': iPurpose.value,
                'activity': iActivity.value,
                'partner': iPartner.value
            };
            
            // 2. ë¡œë”© í™”ë©´ í‘œì‹œ
            showPage(loadingEl);
            
            try {
                // 3. 'AI ì£¼ë°©'(Render ì„œë²„)ì— ì£¼ë¬¸ì„œ(JSON)ë¥¼ ë³´ëƒ„
                const response = await fetch(AI_SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inputs)
                });
                
                if (!response.ok) {
                    throw new Error(`AI ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (HTTP ${response.status})`);
                }
                
                const data = await response.json();

                // 4. 'AI ì…°í”„'ê°€ ë‹µì¥(data)ì„ ì£¼ë©´, ì˜ˆì˜ê²Œ í‘œì‹œ
                if (data.success) {
                    oModelVersion.textContent = `(AI Model: ${data.model_version})`;
                    oProbability.textContent = data.probability_5star_percent + '%';
                    oPersona.textContent = data.persona;
                    // (Markdownì„ HTMLë¡œ ë³€í™˜)
                    oRecommendations.innerHTML = data.recommendations
                        .replace(/\n\n/g, '<br><br>') // ë‹¨ë½ ë‚˜ëˆ„ê¸°
                        .replace(/\n/g, '<br>')   // ì¤„ë°”ê¿ˆ
                        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>') // êµµì€ ê¸€ì”¨
                        .replace(/ğŸ¥‡/g, 'ğŸ†'); // ì•„ì´ì½˜
                    
                    // 5. ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì „í™˜
                    showPage(pageResults);
                    
                } else {
                    throw new Error(data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
                }

            } catch (error) {
                // 6. ì—ëŸ¬ê°€ ë‚˜ë©´ ì•Œë ¤ì¤Œ
                console.error("AI ì„œë²„ í†µì‹  ì˜¤ë¥˜:", error);
                showPage(pageSimulator); // 3ë‹¨ê³„ í™”ë©´ìœ¼ë¡œ ë³µê·€
                alert(`AI ì„œë²„ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        });

        // --- 5. í™”ë©´ ì „í™˜ ë²„íŠ¼ë“¤ ---
        
        // 4 -> 1 (ë‹¤ì‹œ ì‹œë®¬ë ˆì´ì…˜)
        restartBtn4.addEventListener('click', () => showPage(pageSimulator));

        // --- 6. ì•± ì‹œì‘ ---
        showPage(pageSimulator); // ì²« í™”ë©´ì€ ì‹œë®¬ë ˆì´í„°
        
    </script>
</body>
</html>
